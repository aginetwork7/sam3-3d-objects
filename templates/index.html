<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Human to 3D Gaussian Splat Reconstruction</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; }
        .result { margin-top: 30px; border: 1px solid #ccc; padding: 20px; border-radius: 8px; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 8px; }
        img.preview { max-width: 300px; border: 1px solid #aaa; }
    </style>
</head>
<body>
    <h1>Upload Image with People â†’ Generate 3D Models</h1>
    <p>Detects humans, segments them, and reconstructs each as a photorealistic 3D Gaussian Splat using fal-ai/sam-3/3d-objects.</p>
    
    <input type="file" id="image-input" accept="image/*">
    <button onclick="upload()">Generate 3D</button>
    
    <div id="status" style="margin-top:20px; font-weight:bold;"></div>
    <div id="results"></div>

    <script>
        async function upload() {
            const input = document.getElementById('image-input');
            if (!input.files.length) return alert('Select an image');
            
            const formData = new FormData();
            formData.append('file', input.files[0]);
            
            document.getElementById('status').innerHTML = 'Uploading and processing... (detection + 3D generation may take 10-30 seconds)';
            document.getElementById('results').innerHTML = '';
            
            try {
                const resp = await fetch('/agi7/api/ai/person/generate_objects3d/upload', { method: 'POST', body: formData });
                const data = await resp.json();

                if (data.error) {
                    alert('Error: ' + data.error);
                    document.getElementById('status').innerHTML = '';
                    return;
                }

                // Redirect to results page showing the image and PLY viewer
                if (data.results && data.results.length > 0 && data.results[0].ply_url) {
                    const ply = encodeURIComponent(data.results[0].ply_url);
                    const img = encodeURIComponent(data.original_image);
                    window.location.href = `/agi7/api/ai/person/generate_objects3d/results?ply=${ply}&img=${img}`;
                    return;
                }

                // Fallback: show a minimal message
                document.getElementById('results').innerHTML = '<p>No results found.</p>';
                document.getElementById('status').innerHTML = '';
            } catch (e) {
                alert('Failed: ' + e);
                document.getElementById('status').innerHTML = '';
            }
        }
    </script>
</body>
</html>